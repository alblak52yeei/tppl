# Программа для получения данных по сети

Программа для непрерывного получения данных из двух сетевых источников и записи их в один файл.

## Описание

Программа подключается к двум серверам и непрерывно получает данные:
- **Сервер 1** (95.163.237.76:5123): температура и давление
- **Сервер 2** (95.163.237.76:5124): координаты X, Y, Z

Все данные записываются в файл `data.log` с временными метками в формате `YYYY-MM-DD HH:MM:SS`.

## Формат данных

### Сервер 1 (5123)
- 8 байт: метка времени (POSIX timestamp × 10⁶)
- 4 байта: температура (float32)
- 2 байта: давление (int16)
- 1 байт: контрольная сумма

### Сервер 2 (5124)
- 8 байт: метка времени (POSIX timestamp × 10⁶)
- 4 байта: X (int32)
- 4 байта: Y (int32)
- 4 байта: Z (int32)
- 1 байт: контрольная сумма

## Протокол

1. Подключение к серверу
2. Отправка секретного ключа `"isu_pt"` для авторизации
3. Отправка команды `"get"` для запроса данных
4. Получение данных в бинарном формате
5. Повтор шагов 3-4 до остановки программы

Сервер разрывает соединение при неактивности клиента более 5 секунд.

## Установка и запуск

### Требования
- Go 1.21 или выше

### Сборка
```bash
go build
```

### Запуск
```bash
./best_program
```

Программа будет работать до получения сигнала остановки (Ctrl+C).

### Остановка
Нажмите `Ctrl+C` для корректной остановки программы. Все данные будут сохранены в файл.

## Формат выходного файла

Данные записываются в файл `data.log` в формате CSV:

**Сервер 1:**
```
YYYY-MM-DD HH:MM:SS,server1,температура,давление
```

**Сервер 2:**
```
YYYY-MM-DD HH:MM:SS,server2,X,Y,Z
```

Пример:
```
2024-01-15 10:30:45,server1,25.500000,1013
2024-01-15 10:30:45,server2,100,-200,300
```

## Особенности реализации

- **Отказоустойчивость**: автоматическое переподключение при разрыве соединения
- **Высокая производительность**: параллельное получение данных с обоих серверов
- **Проверка целостности**: валидация контрольных сумм для каждого пакета данных
- **Надежная запись**: периодическая синхронизация данных на диск
- **Статистика**: периодический вывод статистики (каждые 30 секунд)

## Тестирование

Запуск тестов:
```bash
go test -v
```

Запуск тестов с покрытием:
```bash
go test -cover
```

## Проверка работы

Для проверки работы программы рекомендуется запустить её не менее чем на 20 минут:

```bash
timeout 20m ./best_program
```

Или просто запустить и остановить через 20+ минут с помощью Ctrl+C.

## Структура проекта

```
best_program/
├── main.go          # Главный файл программы
├── client.go        # Клиент для подключения к серверам
├── parser.go        # Парсинг бинарных данных
├── writer.go        # Запись данных в файл
├── types.go         # Определения типов
├── parser_test.go   # Тесты парсера
├── writer_test.go   # Тесты записи
├── go.mod           # Модуль Go
└── README.md        # Документация
```

## Логирование

Программа выводит в консоль:
- Сообщения о подключении к серверам
- Ошибки соединения и парсинга
- Статистику каждые 30 секунд (количество записей, скорость, время работы)
- Итоговую статистику при остановке

